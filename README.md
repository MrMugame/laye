# Laye
A systems programming language that wears its love for C on its shoulder.

## Philosophy
C is by no means perfect, nor is Laye trying to be perfect in its stead. Rather, Laye understands that C is here to stay for the foreseeable future, and wants to peacefully co-exist with established C code while supporting modern and (hopefully) sensible language features to the table. To achieve this, Laye allows seamless importing of C source files, most commonly the public headers, into any Laye source file. In addition, Laye provides lightweight FFI to expose its own functions and data types to C.

## Requirements

* Any standard compliant C17 compiler (we like Clang)
    - If your compiler does not support an address sanitizer with the `-fsanitize=address` option or you don't have one installed, see the build configuration options for the option to disable it.
* `Clang 18` specifically to compile the IR generated by the LLVM backend
* `CMake` for running fchk tests (see [testing](#testing))

**NOTE**: The build system currently inherits whatever compiler you use to build it. All of the examples here use Clang, so the the project will also be built with clang. If you want to build Laye with GCC instead, replace instances of `clang` with `gcc` and that will propogate.

## Building

1. Build Nob

    This project uses a version of the [Nob](https://github.com/tsoding/nobuild) build system by [Tsoding](https://github.com/tsoding) included with this repository.

    ```bash
    $ clang -o nob nob.c
    ```

2. Run Nob
    `Nob` will automatically rebuild itself if any changes are made to the build script.

    ```bash
    $ ./nob
    ```

    The `layec` compiler driver as well as a `test_runner` for running the automated tests are placed in the `./out` directory.

    The resulting build tool supports the following commands:

    - `./nob build` will build all the projects.
    - `./nob build layec` will build just the Laye compiler driver.
    - `./nob test` will run the full test suite. This requires CMake to run the FCHK tests.

    The build tool supports the following options in most commands:

    - `--no-asan` to disable use of the address sanitizer.

## Usage

```bash
$ ./out/layec [options...] files...
```

Run `./out/layec --help` for a list of avaliable options.

## Testing
The test suite is written for the [`fchk`](https://github.com/Sirraide/fchk) tool, which has a few additional dependencies as listed in [requirements](#requirements).

```bash
$ ./nob test
```

Tests are located in the `./test` directory. Each test file is a source file which defines the test inline, as well as how it should be invoked by the tooling. Read the [`fchk`](https://github.com/Sirraide/fchk) documentation to understand how it works.

### Adding tests

## Editor Support
Laye has a Visual Studio Code extension for syntax hilighting. Find it [here](https://github.com/laye-lang/laye-vscode).

## Docs and the Wiki

The documentation (stored in the `docs` directory) is a git subtree of the [GitHub project wiki](https://github.com/laye-lang/laye/wiki). This allows for the documentation to be referenced and edited from within the main project.

*Thanks to [this gist](https://gist.github.com/yukoff/5220f33123de5e7e428db63ef7025e72) for documentation on how to make this work!*

### Initial local setup

When cloning the main project repository for the first time, the wiki repository must be added as a remote.

```sh
$ git remote add wiki git@github.com:laye-lang/laye.wiki.git
```

### Adding documentation

New and updated documentation should be committed and pushed in the main project repository just like any other file.

*However, care should be taken to ensure documentation files are always committed separately from other project files. Individual commits should never contain both files inside and outside the docs directory.*

### Pushing updates to the wiki

Documentation changes in the main project repository can be pushed to the wiki repository at any time. This does not need to happen every time documentation is added or updated, but can happen as often as desired.

```sh
$ git subtree push --prefix docs wiki master
```

If the GitHub website is used to edit wiki files, then the push will fail, in which case any updates should be pulled as described below.

### Pulling updates from the wiki

It should only be necessary to pull updates directly from the wiki when the GitHub website is used to edit the documentation directly in the wiki. If pushing to the wiki ever fails, try pulling first.

```sh
git subtree pull --prefix docs wiki master --squash --message="Merge wiki updates into docs."
```
